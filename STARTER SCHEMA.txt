CREATE TABLE categories (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    name TEXT NOT NULL,
    type TEXT NOT NULL CHECK (type IN ('expense', 'income', 'debt', 'investment')),
    parent_id UUID REFERENCES categories(id), -- For subcategories
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE budgets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    category_id UUID REFERENCES categories(id) ON DELETE CASCADE,
    amount NUMERIC(12,2) NOT NULL,
    period_start DATE NOT NULL, -- Start of the budget period
    period_end DATE NOT NULL,   -- End of the budget period
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(user_id, category_id, period_start, period_end)
);

CREATE TABLE transactions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    category_id UUID REFERENCES categories(id) ON DELETE SET NULL,
    amount NUMERIC(12,2) NOT NULL,
    type TEXT NOT NULL CHECK (type IN ('income', 'expense')),
    description TEXT,
    transaction_date DATE NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE debts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    name TEXT NOT NULL,          -- e.g., "Credit Card", "Car Loan"
    principal NUMERIC(12,2) NOT NULL,
    interest_rate NUMERIC(5,2),  -- Annual %
    due_date DATE,
    status TEXT CHECK (status IN ('active', 'paid', 'defaulted')),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE debt_payments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    debt_id UUID REFERENCES debts(id) ON DELETE CASCADE,
    transaction_id UUID REFERENCES transactions(id) ON DELETE CASCADE,
    amount NUMERIC(12,2) NOT NULL,
    payment_date DATE NOT NULL
);

CREATE TABLE investments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    name TEXT NOT NULL, -- e.g., "Stocks", "Crypto", "Mutual Fund"
    invested_amount NUMERIC(12,2) NOT NULL,
    current_value NUMERIC(12,2),
    created_at TIMESTAMPTZ DEFAULT NOW()
);